<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Email layout: encapsulation when sending (not used in backend display) -->
        <template id="project_management_digest_template">
            &lt;!DOCTYPE html&gt;
            <html xmlns="http://www.w3.org/1999/xhtml">
                <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
                    <meta name="format-detection" content="telephone=no"/>
                    <meta name="viewport"
                          content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;"/>
                    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE"/>

                    <style type="text/css">
                        .main{
                            border-bottom: 0px;
                            padding: 10px;
                            --primary: rgb(4, 105, 105);
                            color: var(--primary);
                        }
                        .main .heading{

                        }
                        .main .content{
                            margin-left: 5px;
                        }
                        .main .content .project{
                            margin-left: 10px;
                        }
                        .main .content .project .name{
                            display: flex;
                            flex-flow: row;
                            align-items: baseline;
                        }
                        .main .content .project .name div{
                            padding-right: 10px;
                        }
                        .main .content .project .ticket{
                            margin-bottom: 20px;
                        }
                        .main .content .project .ticket .ticket-duration{
                            margin-left: 5px;
                            margin-bottom: 10px;
                        }
                        .main .content .project .ticket .work-log{
                            margin-left: 10px;
                        }
                        .main .content .project .ticket .work-log div{
                            margin-bottom: 7px;
                        }
                    </style>
                </head>
                <body>
                    <t t-raw="body"/>
                </body>
            </html>
        </template>

        <!-- DIGEST MAIN TEMPLATE -->
        <template id="digest_work_log_template">
            <div t-foreach="work_log" t-as="log">
                <span><t t-esc="work_log[log]['ticket_key']"/></span> || <span><span><t t-esc="work_log[log]['description']"/></span></span>
            </div>
        </template>

        <template id="digest_ticket_template">
            <div class="ticket" t-foreach="ticket" t-as="issue">
                <div class="ticket-name">
                    <span><b><t t-esc="ticket[issue]['ticket_key']"/>:</b> <t t-esc="ticket[issue]['ticket_name'][:20] + ..."/></span>
                </div>
                <div class="ticket-duration">Total: <b><em><t t-esc="ticket[issue]['time_duration']"/></em></b></div>
                <div class="work-log">
                    <t t-call="project_management.digest_work_log_template" t-set="work_log" t-value="ticket[issue]['log']"/>
                </div>
            </div>
        </template>

        <template id="digest_project_template">
            <div class="project" t-foreach="payload" t-as="project">
                <div class="name">
                    <div>
                        <h2><t t-esc="payload[project]['project_key']"/>: <t t-esc="payload[project]['project_name']"/></h2>
                    </div>
                    <div>
                        <h3><em><t t-esc="payload[project]['time_duration']"/></em></h3>
                    </div>
                </div>
                <div class="ticket-cluster">
                    <t t-call="project_management.digest_ticket_template" t-set="ticket" t-value="content[project]['payload']"/>
                </div>
            </div>
        </template>
        <template id="bi_dashboard_digest_email">
            <div class="main">
                <div class="heading">
                    <div>
                        <h1><t t-esc="heading['name']"/>: <t t-esc="heading['time_duration']"/></h1>
                    </div>
                    <div>
                        <b>From:</b> <t t-esc="heading['start_date']"/> <b>To:</b> <t t-esc="heading['end_date']"/> (<t t-esc="heading['tz']"/>)
                    </div>
                </div>
                <div class="content" t-foreach="content" t-as="section">
                    <div class="title">
                        <h2><t t-esc="content[section]['title']"/></h2>
                    </div>

<!--                    <t t-call="project_management.digest_project_template" t-set="payload" t-value="content[section]['payload']"/>-->

                </div>
            </div>
        </template>

    </data>
</odoo>
